<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>module ALD::API::Collection::LocalFilter - RDoc Documentation</title>

<link href="../../../fonts.css" rel="stylesheet">
<link href="../../../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../../../";
</script>

<script src="../../../js/jquery.js"></script>
<script src="../../../js/navigation.js"></script>
<script src="../../../js/search_index.js"></script>
<script src="../../../js/search.js"></script>
<script src="../../../js/searcher.js"></script>
<script src="../../../js/darkfish.js"></script>


<body id="top" role="document" class="module">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../../table_of_contents.html#pages">Pages</a>
    <a href="../../../table_of_contents.html#classes">Classes</a>
    <a href="../../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    <div id="sections-section" class="nav-section">
  <h3>Sections</h3>

  <ul class="link-list" role="directory">
    
      <li><a href="#5Buntitled-5D"></a></li>
    
      <li><a href="#Internal">Internal</a></li>
    
  </ul>
</div>

    
    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-apply_conditions">::apply_conditions</a>
    
    <li ><a href="#method-c-can_apply-3F">::can_apply?</a>
    
    <li ><a href="#method-c-filter">::filter</a>
    
    <li ><a href="#method-c-sort">::sort</a>
    
    <li ><a href="#method-c-sort_criteria">::sort_criteria</a>
    
    <li ><a href="#method-c-sortings">::sortings</a>
    
    <li ><a href="#method-c-to_sort_hash">::to_sort_hash</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="module-ALD::API::Collection::LocalFilter">
  <h1 id="module-ALD::API::Collection::LocalFilter" class="module">
    module ALD::API::Collection::LocalFilter
  </h1>

  <section class="description">
    
<p>Used by ItemCollection/UserCollection#where to filter data locally if
possible. All methods are module methods.</p>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
  </section>

  
  
  <section id="Internal" class="documentation-section">
    
    <header class="documentation-section-title">
      <h2>
        Internal
      </h2>
      <span class="section-click-top">
        <a href="#top">&uarr; top</a>
      </span>
    </header>
    

    

    

    

    
     <section id="public-class-Internal-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-apply_conditions" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">apply_conditions</span><span
            class="method-args">(data, conditions)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Apply certain conditions on given data. This is a wrapper method that calls
<a href="LocalFilter.html#method-c-filter">::filter</a>, <a
href="LocalFilter.html#method-c-sort">::sort</a> (if necessary) and applies
a :range condition (if specified).</p>
<dl class="rdoc-list note-list"><dt>data
<dd>
<p>an Array of Hashes representing the entries to apply conditions upon</p>
</dd><dt>conditions
<dd>
<p>the Hash of conditions to apply</p>
</dd></dl>

<h3 id="method-c-apply_conditions-label-Returns">Returns<span><a href="#method-c-apply_conditions-label-Returns">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>Returns the modified data Array.</p>

<p>Raises ArgumentError if the conditions cannot be applied. This can be
avoided by passing them to <a
href="LocalFilter.html#method-c-can_apply-3F">::can_apply?</a> beforehand.</p>
          
          

          
          <div class="method-source-code" id="apply_conditions-source">
            <pre><span class="ruby-comment"># File lib/ALD/local_filter.rb, line 21</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">apply_conditions</span>(<span class="ruby-identifier">data</span>, <span class="ruby-identifier">conditions</span>)
  <span class="ruby-identifier">data</span> = <span class="ruby-identifier">filter</span>(<span class="ruby-identifier">data</span>, <span class="ruby-identifier">conditions</span>)
  <span class="ruby-identifier">data</span> = <span class="ruby-identifier">sort</span>(<span class="ruby-identifier">data</span>, <span class="ruby-identifier">conditions</span>[<span class="ruby-value">:sort</span>])  <span class="ruby-keyword">if</span> <span class="ruby-identifier">conditions</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-value">:sort</span>)
  <span class="ruby-identifier">data</span> = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-identifier">conditions</span>[<span class="ruby-value">:range</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">conditions</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-value">:range</span>)
  <span class="ruby-identifier">data</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-can_apply-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">can_apply?</span><span
            class="method-args">(conditions, local_keys)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Test if the given filter, sort and range conditions can be applied locally
or need a request to the server.</p>
<dl class="rdoc-list note-list"><dt>conditions
<dd>
<p>a Hash of conditions to test</p>
</dd><dt>local_keys
<dd>
<p>an Array of Strings or Symbols, containing the key names that are available
locally Related: <a
href="../CollectionEntry.html#method-c-initialized_attributes">ALD::API::CollectionEntry.initialized_attributes</a></p>
</dd></dl>

<h3 id="method-c-can_apply-3F-label-Returns">Returns<span><a href="#method-c-can_apply-3F-label-Returns">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>Returns a Boolean; true if local application is possible, false otherwise</p>
          
          

          
          <div class="method-source-code" id="can_apply-3F-source">
            <pre><span class="ruby-comment"># File lib/ALD/local_filter.rb, line 38</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">can_apply?</span>(<span class="ruby-identifier">conditions</span>, <span class="ruby-identifier">local_keys</span>)
  <span class="ruby-identifier">local_keys</span>.<span class="ruby-identifier">map!</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:to_sym</span>) <span class="ruby-comment"># symbolize keys</span>

  <span class="ruby-identifier">conditions</span>.<span class="ruby-identifier">all?</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">key</span> <span class="ruby-operator">==</span> <span class="ruby-value">:sort</span>
      <span class="ruby-identifier">sort_criteria</span>(<span class="ruby-identifier">value</span>).<span class="ruby-identifier">all?</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">local_keys</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">c</span>) }
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">local_keys</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">key</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">key</span> <span class="ruby-operator">==</span> <span class="ruby-value">:range</span> <span class="ruby-comment"># range is always supported</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-filter" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">filter</span><span
            class="method-args">(data, conditions)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Filter the given data locally. This does not support range or switch
conditions. Array conditions also only work if the values are exactly the
same, i.e. the same entries in the same order.</p>
<dl class="rdoc-list note-list"><dt>data
<dd>
<p>an Array of Hashes representing the entries to filter</p>
</dd><dt>conditions
<dd>
<p>a Hash of conditions to filter for</p>
</dd></dl>

<h3 id="method-c-filter-label-Returns">Returns<span><a href="#method-c-filter-label-Returns">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>Returns the filtered data array</p>

<p>Raises ArgumentError if a filter is detected that cannot be handled
locally. This can be prevented by calling ::can_filter? first.</p>
          
          

          
          <div class="method-source-code" id="filter-source">
            <pre><span class="ruby-comment"># File lib/ALD/local_filter.rb, line 61</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">filter</span>(<span class="ruby-identifier">data</span>, <span class="ruby-identifier">conditions</span>)
  <span class="ruby-identifier">data</span>.<span class="ruby-identifier">select</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">entry</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">conditions</span>.<span class="ruby-identifier">all?</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> [<span class="ruby-value">:sort</span>, <span class="ruby-value">:range</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">key</span>)
        <span class="ruby-keyword">true</span> <span class="ruby-comment"># must be done somewhere else</span>
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-identifier">key</span>.<span class="ruby-identifier">to_s</span>) <span class="ruby-comment"># should be a locally available key</span>
        <span class="ruby-identifier">entry</span>[<span class="ruby-identifier">key</span>.<span class="ruby-identifier">to_s</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">value</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>  <span class="ruby-comment"># should be prevented by can_filter?</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-sort" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">sort</span><span
            class="method-args">(data, sort)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sort the given data locally</p>
<dl class="rdoc-list note-list"><dt>data
<dd>
<p>the Array of Hashes representing entries</p>
</dd><dt>sort
<dd>
<p>either: a Hash, associating sorting criteria (symbols) to sorting direction
(:asc ord :desc); or an Array of Symbols representing sorting criteria
(direction defaults to :asc)</p>
</dd></dl>

<h3 id="method-c-sort-label-Returns">Returns<span><a href="#method-c-sort-label-Returns">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>Returns the sorted data array</p>
          
          

          
          <div class="method-source-code" id="sort-source">
            <pre><span class="ruby-comment"># File lib/ALD/local_filter.rb, line 83</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">sort</span>(<span class="ruby-identifier">data</span>, <span class="ruby-identifier">sort</span>)
  <span class="ruby-identifier">sort</span> = <span class="ruby-identifier">to_sort_hash</span>(<span class="ruby-identifier">sort</span>)
  <span class="ruby-identifier">data</span>.<span class="ruby-identifier">sort</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">a</span>, <span class="ruby-identifier">b</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">sortings</span>(<span class="ruby-identifier">sort</span>, <span class="ruby-identifier">a</span>, <span class="ruby-identifier">b</span>).<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">s</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> } <span class="ruby-operator">||</span> <span class="ruby-value">0</span> <span class="ruby-comment"># use highest-priority (i.e. first) sorting info != 0</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="private-class-Internal-method-details" class="method-section">
       <header>
         <h3>Private Class Methods</h3>
       </header>

    
      <div id="method-c-sort_criteria" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">sort_criteria</span><span
            class="method-args">(sort)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The inverse of <a
href="LocalFilter.html#method-c-to_sort_hash">::to_sort_hash</a>.</p>
<dl class="rdoc-list note-list"><dt>sort
<dd>
<p>an Array or Hash, in the format described in <a
href="LocalFilter.html#method-c-sort">::sort</a></p>
</dd></dl>

<h3 id="method-c-sort_criteria-label-Returns">Returns<span><a href="#method-c-sort_criteria-label-Returns">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>Returns an Array, in the format described in <a
href="LocalFilter.html#method-c-sort">::sort</a>.</p>
          
          

          
          <div class="method-source-code" id="sort_criteria-source">
            <pre><span class="ruby-comment"># File lib/ALD/local_filter.rb, line 129</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">sort_criteria</span>(<span class="ruby-identifier">sort</span>)
  <span class="ruby-identifier">sort</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">sort</span>.<span class="ruby-identifier">keys</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">sort</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-sortings" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">sortings</span><span
            class="method-args">(sort, a, b)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Get the sort order for given criteria.</p>
<dl class="rdoc-list note-list"><dt>sort
<dd>
<p>a Hash as described in <a href="LocalFilter.html#method-c-sort">::sort</a>
a, b - the Hashes to compare</p>
</dd></dl>

<h3 id="method-c-sortings-label-Returns">Returns<span><a href="#method-c-sortings-label-Returns">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>Returns an Array of Integers (-1, 0, +1), where each represents the sort
order for one of the sort keys.</p>
          
          

          
          <div class="method-source-code" id="sortings-source">
            <pre><span class="ruby-comment"># File lib/ALD/local_filter.rb, line 97</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">sortings</span>(<span class="ruby-identifier">sort</span>, <span class="ruby-identifier">a</span>, <span class="ruby-identifier">b</span>)
  <span class="ruby-identifier">sort</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">dir</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">key</span> = <span class="ruby-identifier">key</span>.<span class="ruby-identifier">to_s</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">key</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;version&#39;</span>
      <span class="ruby-identifier">result</span> = <span class="ruby-constant">Semantic</span><span class="ruby-operator">::</span><span class="ruby-constant">Version</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">a</span>[<span class="ruby-identifier">key</span>]) <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-constant">Semantic</span><span class="ruby-operator">::</span><span class="ruby-constant">Version</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">b</span>[<span class="ruby-identifier">key</span>])
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">result</span> = <span class="ruby-identifier">a</span>[<span class="ruby-identifier">key</span>] <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">b</span>[<span class="ruby-identifier">key</span>]
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">dir</span> <span class="ruby-operator">==</span> <span class="ruby-value">:asc</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">result</span> <span class="ruby-operator">:</span> <span class="ruby-operator">-</span><span class="ruby-identifier">result</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-to_sort_hash" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">to_sort_hash</span><span
            class="method-args">(sort)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Create a sorting Hash from an Array.</p>
<dl class="rdoc-list note-list"><dt>sort
<dd>
<p>a Hash or Array, in the format described in <a
href="LocalFilter.html#method-c-sort">::sort</a></p>
</dd></dl>

<h3 id="method-c-to_sort_hash-label-Returns">Returns<span><a href="#method-c-to_sort_hash-label-Returns">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>Returns a Hash, in the format described in <a
href="LocalFilter.html#method-c-sort">::sort</a>.</p>
          
          

          
          <div class="method-source-code" id="to_sort_hash-source">
            <pre><span class="ruby-comment"># File lib/ALD/local_filter.rb, line 115</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">to_sort_hash</span>(<span class="ruby-identifier">sort</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">sort</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>)
    <span class="ruby-identifier">sort</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">Hash</span>[<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">c</span>, <span class="ruby-value">:asc</span>] }]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://rdoc.rubyforge.org">RDoc</a> 4.1.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

